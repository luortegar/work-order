<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8"/>
    <title>Orden de Trabajo #OT967</title>
    <style>
        /* ===== PÁGINA (OpenHTMLToPDF / Flying Saucer style) ===== */
        @page {
          size: Letter;
          margin: 20mm;
        }

        body {
          font-family: Arial, sans-serif;
          margin: 0;
          color: #333;
          font-size: 10pt;
        }

        .page-container { margin: 0; }

        /* ===== ENCABEZADO ===== */
        .header {
          border-bottom: 2px solid #0056b3;
          padding-bottom: 5mm;
          margin-bottom: 6mm;
        }
        .header-table {
          width: 100%;
          border-collapse: collapse;
        }
        .header-table td {
          vertical-align: top;
        }
        .logo-cell {
          width: 60mm;
        }
        .logo-cell img {
          height: 18mm; /* fijo para PDF */
        }
        .title-cell {
          text-align: right;
          font-size: 12pt;
        }
        .title-cell h1 {
          margin: 0;
          color: #0056b3;
          font-size: 12pt;
        }
        .title-cell p { margin: 2mm 0 0 0; }

        /* ===== SECCIONES ===== */
        .section {
          border: 0.2mm solid #cccccc;
          border-radius: 2mm;
          padding: 4mm;
          margin-bottom: 6mm;
          background-color: #fafafa;
          page-break-inside: avoid;
        }
        .section h2 {
          margin: 0 0 3mm 0;
          padding-bottom: 2mm;
          border-bottom: 0.2mm solid #dddddd;
          font-size: 12pt;
          color: #0056b3;
        }

        /* ===== DOS COLUMNAS (tabla fija) ===== */
        .two-col-table {
          width: 100%;
          border-collapse: collapse;
          table-layout: fixed;
        }
        .two-col-table td {
          width: 50%;
          padding: 0 3mm;
          vertical-align: top;
        }

        /* ===== LISTAS ===== */
        ul { margin: 0; padding-left: 5mm; }
        .details-list ul { list-style: none; padding-left: 0; }
        .details-list li { margin-bottom: 1.5mm; }
        .observations ul { list-style: disc; }
        .observations li { margin-bottom: 1.5mm; }

        /* ===== FIRMAS (mejoradas) ===== */
        .signatures {
          page-break-inside: avoid;
          margin-top: 10mm;
        }
        .sign-table {
          width: 100%;
          border-collapse: collapse;
          table-layout: fixed;
        }
        .sign-table td {
          width: 50%;
          text-align: center;
          vertical-align: top;
          padding: 6mm 4mm;
        }
        .signature-block {
          display: flex;
          flex-direction: column;
          align-items: center;
        }
        .signature-block img {
          max-width: 50mm;
          max-height: 20mm;
          margin-bottom: 4mm;
          border-bottom: 0.3mm solid #000; /* línea de firma */
          padding-bottom: 2mm;
        }
        .signature-info strong {
          display: block;
          font-size: 10pt;
          margin-top: 2mm;
          color: #333;
        }
        .signature-info span {
          font-size: 9pt;
          color: #555;
        }

        /* ===== CONTACTO ===== */
        .contact {
          text-align: center;
          margin-top: 5mm;
          font-size: 7pt;
          color: #777;
        }

        /* ===== GALERÍA DE FOTOS ===== */
        .photo-gallery { margin-top: 4mm; }
        .photo-gallery h2 {
          text-align: center;
          color: #0056b3;
          border-bottom: 0.2mm solid #dddddd;
          padding-bottom: 2mm;
          margin: 0 0 5mm 0;
        }
        .photo-table {
          width: 100%;
          border-collapse: collapse;
          table-layout: fixed;
        }
        .photo-table td {
          width: 50%;
          text-align: center;
          padding: 2mm;
          vertical-align: top;
          page-break-inside: avoid;
        }
        .photo {
          width: 80mm;
          height: auto;
          border: 0.4mm solid #0056b3;
          border-radius: 2mm;
        }

        /* ===== SALTO DE PÁGINA ===== */
        .page-break { page-break-before: always; }
    </style>
</head>
<body>
<div class="page-container">
    <div class="header">
        <table class="header-table">
            <tr>
                <td class="logo-cell">
                    <img th:src="${data.logo}" alt="Logo de la empresa"/>
                </td>
                <td class="title-cell">
                    <h1>ORDEN DE TRABAJO #<span th:text="${data.workOrderNumber}"></span></h1>
                    <p th:text="${data.companyName + ' (' + data.branchLocation + ')'}"></p>
                </td>
            </tr>
        </table>
    </div>

    <div class="section">
        <h2>Detalles Generales</h2>
        <table class="two-col-table">
            <tr>
                <td>
                    <p><strong>Cliente:</strong> <span th:text="${data.clientName}"></span></p>
                    <p><strong>Teléfono:</strong> <span th:text="${data.clientPhone}"></span></p>
                    <p><strong>Correo:</strong> <span th:text="${data.clientEmail}"></span></p>
                </td>
                <td>
                    <p><strong>Inicio:</strong> <span th:text="${data.startDateTime}"></span></p>
                    <p><strong>Término:</strong> <span th:text="${data.endDateTime}"></span></p>
                    <p><strong>Horas Mano de obra:</strong> <span th:text="${data.laborHours}"></span></p>
                    <p><strong>Horas Traslado:</strong> <span th:text="${data.travelHours}"></span></p>
                </td>
            </tr>
        </table>
    </div>

    <div class="section details-list">
        <h2>Detalle del Servicio</h2>
        <ul>
            <li th:each="item : ${data.serviceDetails}" th:text="'• ' + ${item}"></li>
        </ul>
    </div>

    <div class="section observations">
        <h2>Observaciones</h2>
        <ul>
            <li th:each="obs : ${data.observations}" th:text="${obs}"></li>
        </ul>
    </div>

    <!-- ===== FIRMAS MEJORADAS ===== -->
    <div class="signatures">
        <table class="sign-table">
            <tr>
                <td th:each="sig : ${data.signatures}">
                    <div class="signature-block">
                        <img alt="Firma de [[${sig.name}]]" th:src="${sig.signaturesImg}"/>
                        <div class="signature-info">
                            <strong th:text="${sig.name}"></strong>
                            <span th:text="${sig.contact}"></span>
                        </div>
                    </div>
                </td>
            </tr>
        </table>
    </div>

    <div class="contact">
        <p th:text="${data.companyFooterLine1}"></p>
        <p th:text="${data.companyFooterLine2}"></p>
    </div>
</div>

<!-- ========== PÁGINA 2 ========== -->
<div class="page-break"></div>
<div class="page-container">
    <div class="header">
        <table class="header-table">
            <tr>
                <td class="logo-cell">
                    <img th:src="${data.logo}" alt="Logo de la empresa"/>
                </td>
                <td class="title-cell">
                    <h1>ORDEN DE TRABAJO #<span th:text="${data.workOrderNumber}"></span></h1>
                    <p th:text="${data.companyName + ' (' + data.branchLocation + ')'}"></p>
                </td>
            </tr>
        </table>
    </div>
    <div class="photo-gallery">
        <table class="photo-table" th:with="size=${#lists.size(data.photoList)}">
            <tbody>
            <tr th:each="i : ${#numbers.sequence(0, size - 1, 2)}">
                <td>
                    <img class="photo" th:src="${data.photoList[i]}" alt="Foto del trabajo"/>
                </td>
                <td>
                    <img class="photo"
                         th:if="${i + 1 < size}"
                         th:src="${data.photoList[i + 1]}"
                         alt="Foto del trabajo"/>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
    <div class="contact">
        <p th:text="${data.companyFooterLine1}"></p>
        <p th:text="${data.companyFooterLine2}"></p>
    </div>
</div>
</body>
</html>
